# ---------------------------------------------------------------------------- #
# Metrics required LPJmL outputs and boundaries functions
# ---------------------------------------------------------------------------- #
metric:
    # Biome classification
    biome:
        spatial_resolution:
            subglobal:
                default:
                    # LPJmL output IDs with required resolution
                    output: &biome_output
                        grid:
                            resolution: "annual"
                            optional: false
                        fpc:
                            resolution: "annual"
                            optional: false
                        vegc:
                            resolution: "annual"
                            optional: true
                        pft_lai:
                            resolution: "annual"
                            optional: true
                        temp:
                            resolution: "annual"
                            optional: true
                        elevation:
                            resolution: "annual"
                            optional: true
                    # Called boundaries functions
                    fun_name: "classify_biomes"
                    funs: &biome_fun
                            - classify_biomes

    # Calculate bluewater boundary
    bluewater: &bluewater
        spatial_resolution:
            global:
                wang-erlandsson2022: &wang-erlandsson2022_bw
                   # LPJmL output IDs with required resolution
                    output:
                        grid:
                            resolution: "annual"
                            optional: false
                        discharge:
                            resolution: "monthly"
                            optional: false
                    threshold:
                        holocene: 0.5
                        pb: 0.95
                        highrisk: 0.99
                porkka2023: 
                    <<: *wang-erlandsson2022_bw
            subglobal:
                wang-erlandsson2022: &wang-erlandsson2022_bw_sub
                    output:
                        grid:
                            resolution: "annual"
                            optional: false
                        discharge:
                            resolution: "monthly"
                            optional: false
                        drainage:
                            resolution: "annual"
                            optional: false
                    threshold:
                        holocene: 0.5
                        pb: 0.95
                        highrisk: 0.99
                porkka2023:
                    <<: *wang-erlandsson2022_bw_sub
            grid:
                wang-erlandsson2022:
                    <<: *wang-erlandsson2022_bw
                porkka2023:
                    <<: *wang-erlandsson2022_bw
                gerten2020:
                    output:
                        grid:
                            resolution: "annual"
                            optional: false
                        discharge:
                            resolution: "monthly"
                            optional: false
                        irrig:
                           resolution: "monthly"
                           optional: true
                    threshold:
                        holocene: 0
                        pb: 0.05
                        highrisk: 0.75
        fun_name: "calc_bluewater_status"
        # Called boundaries functions
        funs:
            - calc_bluewater_status

    # Calculate greenwater boundary
    greenwater: &greenwater
        spatial_resolution:
            global:
                wang-erlandsson2022: &wang-erlandsson2022_gw
                   # LPJmL output IDs with required resolution
                   output:
                       grid:
                           resolution: "annual"
                           optional: false
                       rootmoist:
                           resolution: "monthly"
                           optional: false
                   threshold:
                       holocene: 0.5
                       pb: 0.95
                       highrisk: 0.99
                porkka2023: 
                    <<: *wang-erlandsson2022_gw #TODO correct?
            subglobal:
                wang-erlandsson2022: &wang-erlandsson2022_gw_sub
                    output:
                        grid:
                            resolution: "annual"
                            optional: false
                        rootmoist:
                            resolution: "monthly"
                            optional: false
                        drainage:
                            resolution: "annual"
                            optional: false
                    threshold:
                        holocene: 0.5
                        pb: 0.95
                        highrisk: 0.99
                porkka2023:
                    <<: *wang-erlandsson2022_gw_sub
            grid:
                wang-erlandsson2022: 
                    <<: *wang-erlandsson2022_gw
                porkka2023:
                    <<: *wang-erlandsson2022_gw
        # Called boundaries functions#
        fun_name: "calc_greenwater_status"
        funs:
            - calc_greenwater_status

    # Calculate nitrogen boundary
    nitrogen: &nitrogen
        spatial_resolution:
            grid:
                braun2022: &braun2022_n
                    # LPJmL output IDs with required resolution
                    output:
                        grid:
                            resolution: "annual"
                            optional: false
                        runoff:
                            resolution: "monthly"
                            optional: false
                        leaching:
                            resolution: "monthly"
                            optional: false
                        pet:
                            resolution: "monthly"
                            optional: false
                        prec:
                            resolution: "monthly"
                            optional: true
                    threshold:
                        holocene: 0
                        pb: 2
                        highrisk: 5
                braun2022_minusref:
                    <<: *braun2022_n
            global:
                schulte_uebbing2022:
                    output:    
                        cftfrac:
                            resolution: "annual"
                            optional: false
                        terr_area: 
                            resolution: "annual"
                            optional: false
                        nfert_agr:
                            resolution: "annual"
                            optional: false
                        nfert_mgrass:
                            resolution: "annual"
                            optional: false
                        nmanure_agr:
                            resolution: "annual"
                            optional: false
                        nmanure_mgrass:
                            resolution: "annual"
                            optional: false
                        pft_bnf:
                            resolution: "annual"
                            optional: false
                        seedn_agr:
                            resolution: "annual"
                            optional: false
                        flux_estabn_mgrass:
                            resolution: "annual"
                            optional: false
                        harvestn:
                            resolution: "annual"
                            optional: false
                        ndepos:
                            resolution: "annual"
                            optional: false
                    threshold:
                        holocene: 0
                        pb: 35
                        highrisk: 84
        # Called boundaries functions
        fun_name: "calc_nitrogen_status"
        funs: &nitrogen_fun
            - calc_nitrogen_status

    # Calculate lsc boundary
    lsc: &lsc
        spatial_resolution:
            global:
                steffen2015:
                    # LPJmL output IDs with required resolution
                    output:
                        <<: *biome_output
                    threshold:
                        holocene: 0
                        pb: 0.25
                        highrisk: 0.46
            subglobal:
                steffen2015: &steffen2015_lsc
                    # LPJmL output IDs with required resolution
                    output:
                        <<: *biome_output
                    threshold:
                        holocene:
                            boreal: 0
                            temperate: 0
                            tropical: 0
                        pb:
                            boreal: 0.15
                            temperate: 0.5
                            tropical: 0.15
                        highrisk:
                            boreal: 0.4
                            temperate: 0.7
                            tropical: 0.4
            grid:
                steffen2015:
                   <<: *steffen2015_lsc
        fun_name: "calc_lsc_status"
        funs:
            - *biome_fun
            - calc_lsc_status


    # Calculate biosphere status based on biocol
    biosphere:
        spatial_resolution:
            global:
                stenzel2023:
                    # LPJmL output IDs with required resolution
                    output: &stenzel2023_biosphere_output
                        grid:
                            resolution: "annual"
                            optional: false
                        terr_area:
                            resolution: "annual"
                            optional: false
                        npp:
                            resolution: "annual"
                            optional: false
                        pft_npp:
                            resolution: "annual"
                            optional: false
                        pft_harvestc:
                            resolution: "annual"
                            optional: false
                        pft_rharvestc:
                            resolution: "annual"
                            optional: false
                        firec:
                            resolution: "annual"
                            optional: false
                        timber_harvestc:
                            resolution: "annual"
                            optional: false
                        cftfrac:
                            resolution: "annual"
                            optional: false
                        fpc:
                            resolution: "annual"
                            optional: false
                    threshold: &stenzel2023_biosphere_threshold
                        holocene: 0
                        pb: 0.1
                        highrisk: 0.2
            subglobal:
                stenzel2023:
                    output:
                      <<: *biome_output
                      <<: *stenzel2023_biosphere_output
                    threshold:
                      <<: *stenzel2023_biosphere_threshold

            grid:
                stenzel2023:
                    output:
                      <<: *stenzel2023_biosphere_output
                    threshold:
                      <<: *stenzel2023_biosphere_threshold

        # Called boundaries functions
        fun_name: "calc_biosphere_status"
        funs:
            - *biome_fun
            - calc_biosphere_status



# ---------------------------------------------------------------------------- #
# Allowed output file names for LPJmL output IDs
# ---------------------------------------------------------------------------- #
file_name:
    grid: ["grid"]
    terr_area: ["terr_area"]
    discharge: ["discharge", "mdischarge"]
    irrig: ["irrig", "mirrig"]
    rootmoist:  ["rootmoist", "mrootmoist"]
    swc: ["swc", "mswc"]
    fpc: ["fpc"]
    fpc_bft: ["fpc_bft"]
    cftfrac: ["cftfrac"]
    firec: ["firec", "mfirec"]
    npp: ["npp", "mnpp"]
    runoff: ["runoff", "mrunoff"]
    transp: ["transp", "mtransp"]
    vegc: ["vegc"]
    firef: ["firef", "mfiref"]
    rh: ["rh"]
    harvestc: ["harvestc"]
    evap: ["evap", "mevap"]
    interc: ["interc", "minterc"]
    soilc: ["soilc"]
    litc: ["litc"]
    vegn: ["vegn"]
    soilnh4: ["soilnh4"]
    soilno3: ["soilno3"]
    leaching: ["leaching", "mleaching"]
    n2o_denit: ["n2o_denit", "mn2o_denit"]
    n2o_nit: ["n2o_nit", "mn2o_nit"]
    n2_emis: ["n2_emis", "mn2_emis"]
    bnf: ["bnf", "mbnf"]
    n_volatilization: ["n_volatilization", "mn_volatilization"]
    pft_npp: ["pft_npp"]
    pft_harvestc: ["pft_harvestc", "pft_harvest.pft"]
    pft_rharvestc: ["pft_rharvestc", "pft_rharvest.pft"]
    timber_harvestc: ["timber_harvestc"]
    pft_lai: ["pft_lai", "mpft_lai"]
    temp: ["temp", "mtemp"]
    pet: ["pet", "mpet"]
    prec: ["prec","mprec"]
    nfert_agr: ["nfert_agr"]
    nfert_mgrass: ["nfert_mgrass"]
    nmanure_agr: ["nmanure_agr"]
    nmanure_mgrass: ["nmanure_mgrass"]
    pft_bnf: ["pft_bnf"]
    seedn_agr: ["seedn_agr"]
    flux_estabn_mgrass: ["flux_estabn_mgrass"]
    harvestn: ["harvestn", "flux_harvestn"]
    ndepos: ["ndepos"]
    drainage: ["drainage"]
